<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Cellismo Converter - シングルセル解析ファイル変換ツール</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <h1>🧬 To-Cellismo Converter</h1>
                <p class="subtitle">シングルセル解析ファイルをh5mu形式に簡単変換</p>
                <div class="format-badges">
                    <span class="badge-format">CSV</span>
                    <span class="badge-format">RDS</span>
                    <span class="badge-format">MEX</span>
                    <span class="badge-arrow">→</span>
                    <span class="badge-format highlight">h5mu</span>
                </div>
            </div>
        </header>

        <div class="main-content">
            <!-- Step 1: File Type Selection -->
            <section class="step-card">
                <div class="step-header">
                    <span class="step-number">1</span>
                    <h2>ファイル形式を選択</h2>
                </div>

                <div class="file-type-selector">
                    <label class="file-type-card">
                        <input type="radio" name="file_type" value="csv" checked>
                        <div class="card-content">
                            <div class="card-icon">📊</div>
                            <h3>CSV</h3>
                            <p>カウントマトリックス</p>
                            <div class="card-info">
                                <small>SeqGeq形式自動認識</small>
                            </div>
                        </div>
                    </label>

                    <label class="file-type-card">
                        <input type="radio" name="file_type" value="rds">
                        <div class="card-content">
                            <div class="card-icon">📦</div>
                            <h3>RDS</h3>
                            <p>Seurat / SCE</p>
                            <div class="card-badge badge-dev">要rpy2</div>
                        </div>
                    </label>

                    <label class="file-type-card">
                        <input type="radio" name="file_type" value="mex">
                        <div class="card-content">
                            <div class="card-icon">🧬</div>
                            <h3>MEX</h3>
                            <p>10x Genomics</p>
                            <div class="card-info">
                                <small>.zip / .tar.gz</small>
                            </div>
                        </div>
                    </label>
                </div>
            </section>

            <!-- Step 2: File Upload -->
            <section class="step-card">
                <div class="step-header">
                    <span class="step-number">2</span>
                    <h2>ファイルをアップロード</h2>
                </div>

                <div class="file-upload">
                    <input type="file" id="fileInput" accept=".csv,.rds,.mtx,.tsv,.gz,.zip,.tar" style="display: none;">
                    <div class="upload-area" id="uploadArea">
                        <div class="upload-icon">
                            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="17 8 12 3 7 8"></polyline>
                                <line x1="12" y1="3" x2="12" y2="15"></line>
                            </svg>
                        </div>
                        <p class="upload-text">ファイルをドラッグ&ドロップ</p>
                        <p class="upload-subtext">または</p>
                        <button type="button" class="btn-browse">ファイルを選択</button>
                    </div>
                    <div id="fileInfo" class="file-info-display" style="display: none;">
                        <div class="file-icon">📄</div>
                        <div class="file-details">
                            <p class="file-name" id="fileName"></p>
                            <p class="file-size" id="fileSize"></p>
                        </div>
                        <button type="button" class="btn-remove" id="removeFileBtn">✕</button>
                    </div>
                </div>
            </section>

            <!-- Step 3: Options (CSV only) -->
            <section class="step-card" id="csvOptionsSection">
                <div class="step-header">
                    <span class="step-number">3</span>
                    <h2>変換オプション</h2>
                </div>

                <div class="options-grid">
                    <label class="option-card">
                        <input type="checkbox" id="transpose" name="transpose">
                        <div class="option-content">
                            <div class="option-icon">🔄</div>
                            <div class="option-text">
                                <h4>転置</h4>
                                <p>遺伝子×細胞 → 細胞×遺伝子</p>
                            </div>
                        </div>
                    </label>

                    <label class="option-card checked">
                        <input type="checkbox" id="hasHeader" name="has_header" checked>
                        <div class="option-content">
                            <div class="option-icon">📋</div>
                            <div class="option-text">
                                <h4>ヘッダー行</h4>
                                <p>1行目を細胞名として扱う</p>
                            </div>
                        </div>
                    </label>

                    <label class="option-card checked">
                        <input type="checkbox" id="hasIndex" name="has_index" checked>
                        <div class="option-content">
                            <div class="option-icon">🔢</div>
                            <div class="option-text">
                                <h4>インデックス列</h4>
                                <p>1列目を遺伝子名として扱う</p>
                            </div>
                        </div>
                    </label>
                </div>
            </section>

            <!-- Step 4: Convert Button -->
            <section class="convert-section">
                <button id="convertBtn" class="btn-convert" disabled>
                    <span class="btn-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="23 4 23 10 17 10"></polyline>
                            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                        </svg>
                    </span>
                    <span class="btn-text">h5mu に変換</span>
                </button>
                <p class="convert-note">出力: <code>convert_元のファイル名.h5mu</code></p>
            </section>

            <!-- Status Section -->
            <div id="statusSection" class="status-section" style="display: none;">
                <div id="statusMessage" class="status-message"></div>
                <div id="progressBar" class="progress-bar">
                    <div class="progress-fill"></div>
                </div>
            </div>
        </div>

        <!-- Info Panel -->
        <aside class="info-panel">
            <div class="info-card">
                <h3>💡 対応形式</h3>
                <dl class="info-list">
                    <dt>📊 CSV</dt>
                    <dd>遺伝子×細胞または細胞×遺伝子のマトリックス<br><strong>SeqGeq形式を自動認識</strong></dd>

                    <dt>📦 RDS</dt>
                    <dd>SeuratまたはSingleCellExperimentオブジェクト<br>※ Rとrpy2が必要</dd>

                    <dt>🧬 MEX</dt>
                    <dd>10x Genomics形式のスパースマトリックス<br><strong>.zip または .tar.gz 対応</strong></dd>
                </dl>
            </div>

            <div class="info-card">
                <h3>📖 h5mu形式とは</h3>
                <p>MuData形式のファイルで、マルチモーダルなシングルセル解析データを効率的に保存できます。</p>
                <ul class="feature-list">
                    <li>✓ PythonとRの両方で使用可能</li>
                    <li>✓ 圧縮により省スペース</li>
                    <li>✓ scanpy、MuDataで利用</li>
                    <li>✓ <strong>BD Cellimoに直接インポート可能</strong></li>
                </ul>
            </div>

            <div class="info-card">
                <h3>🔗 リンク</h3>
                <div class="link-list">
                    <a href="https://github.com/BDkokishinbara/To-Cellismo-converter" target="_blank" class="info-link">
                        <span>📂</span> GitHub
                    </a>
                    <a href="https://mudata.readthedocs.io/" target="_blank" class="info-link">
                        <span>📚</span> MuData Docs
                    </a>
                    <a href="https://scanpy.readthedocs.io/" target="_blank" class="info-link">
                        <span>🔬</span> Scanpy Docs
                    </a>
                </div>
            </div>
        </aside>

        <footer>
            <p>To-Cellismo Converter v1.1 | MIT License</p>
        </footer>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
